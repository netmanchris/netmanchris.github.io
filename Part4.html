<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<p style="box-sizing: border-box; margin: 0px;"><em style="box-sizing: border-box;">note: It's come to my attention that Wordpress is truncating some of my posts so that the right hand side is blocked by the side bar. My apologies for the this. I'll get it fixed ( or more likely move to GH pages ) as quickly as possible. Please <a href="http://netmanchris.github.io/Part4.html">click here to see this post</a> without the formatting issues. Thanks for your patience</em></p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;"><em style="box-sizing: border-box;">@netmanchris</em></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Deploying-Code-to-Devices-Through-your-NMS" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Deploying Code to Devices Through your NMS</h1>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">If you're luck enough to have an NMS as powerful as <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="http://www.hpe.com/networking/imc">HPE IMC</a> then you already have a very capable system which has a ton of APIs that you probably didn't even know about.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">We've spent the last few posts ( <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="https://kontrolissues.wordpress.com/2016/01/14/intro-to-jinja2/">here</a>, <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="https://kontrolissues.wordpress.com/2016/01/19/more-jinja-working-with-yam-as-an-input/">here</a>, and <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="https://kontrolissues.wordpress.com/2016/01/29/git-and-jinja-like-peanut-butter-and-pickles/]">here</a> running through creating some network configurations through the <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="http://jinja.pocoo.org/docs/dev/">Jinja2 templating language</a>.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">There are at least a couple of immediate benefits to this approach:</p>
<ul style="box-sizing: border-box; margin: 1em 2em 0px; list-style-position: initial; list-style-image: initial; padding-left: 0px;">
<li style="box-sizing: border-box;">Consistency in the configuration between devices</li>
<li style="box-sizing: border-box;">Accuracy in the commands going into your devices</li>
</ul>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">But the one large draw back is that you've <span style="box-sizing: border-box; font-weight: bold;">still</span> got to cut and paste that configuration into your device somehow, which is not the ideal scenario. We're trying to get away from touching our devices.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">In this post, we're going to look at taking the rendered configuration and pushing it directly to the desired device through HPE IMC's RESTful API, refered to as the eAPI in documentation.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">*Although there used to be a charge for this, HPE recently made some changes and the RESTful API is now included in both</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [2]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">requests</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">yaml</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">githubuser</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">pyhpeimc.auth</span> <span class="k" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="o" style="box-sizing: border-box; color: #666666;">*</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">pyhpeimc.plat.device</span> <span class="k" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="o" style="box-sizing: border-box; color: #666666;">*</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">pyhpeimc.plat.icc</span> <span class="k" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="o" style="box-sizing: border-box; color: #666666;">*</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">pyhpeimc.plat.vlanm</span> <span class="k" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="o" style="box-sizing: border-box; color: #666666;">*</span>
<span class="kn" style="box-sizing: border-box; color: #008000; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #0000ff; font-weight: bold;">jinja2</span> <span class="k" style="box-sizing: border-box; color: #008000; font-weight: bold;">import</span> <span class="n" style="box-sizing: border-box;">Environment</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">FileSystemLoader</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">Template</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Loading-the-templates-and-values-from-Git" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Loading the templates and values from Git</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [4]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">comware_template</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">requests</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">get</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'https://raw.githubusercontent.com/netmanchris/Jinja2-Network-Configurations-Scripts/master/comware_vlan.j2'</span><span class="p" style="box-sizing: border-box;">)</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">text</span>
<span class="n" style="box-sizing: border-box;">gitauth</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">githubuser</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">gitcreds</span><span class="p" style="box-sizing: border-box;">()</span> <span class="c" style="box-sizing: border-box; color: #408080; font-style: italic;">#you didn't think I was going to give you my password did you?</span>
<span class="n" style="box-sizing: border-box;">simple</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">yaml</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">load</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">requests</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">get</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'https://raw.githubusercontent.com/netmanchris/Jinja2-Network-Configurations-Scripts/master/vlans.yaml'</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">=</span><span class="n" style="box-sizing: border-box;">gitauth</span><span class="p" style="box-sizing: border-box;">)</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">text</span><span class="p" style="box-sizing: border-box;">)</span>
<span class="n" style="box-sizing: border-box;">cw_template</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">Template</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">comware_template</span><span class="p" style="box-sizing: border-box;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Rendering-the-template" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Rendering the template</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [5]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">my_template</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">cw_template</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">render</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">simple</span><span class="o" style="box-sizing: border-box; color: #666666;">=</span><span class="n" style="box-sizing: border-box;">simple</span><span class="p" style="box-sizing: border-box;">)</span>
<span class="nb" style="box-sizing: border-box; color: #008000;">print</span> <span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">my_template</span><span class="p" style="box-sizing: border-box;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div class="output_wrapper" style="box-sizing: border-box; -webkit-box-align: stretch; display: flex; flex-direction: column; align-items: stretch; z-index: 1;">
<div class="output" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch;">
<div class="output_area" style="box-sizing: border-box; padding: 0px; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0px 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em;"> </div>
<div class="output_subarea output_stream output_stdout output_text" style="box-sizing: border-box; overflow-x: auto; padding: 0.4em; -webkit-box-flex: 1; flex: 1 1 0%; max-width: calc(100% - 14ex); line-height: 1.21429em;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; line-height: inherit; white-space: pre-wrap; vertical-align: baseline; background-color: transparent;">#vlan config
vlan 1
    name default
    description default
vlan 2
    name TenantABC
    description TenantABC
vlan 3
    name management
    description management
vlan 10
    name mgmt
    description mgmt

</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Options,-Options,-Options..." style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Options, Options, Options...</h1>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">We now have a decision to make. There are a couple of different APIs available to us to push VLANs to the device.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">For this example, we're going to use the executecmd API that allows us to send a series of commands to the device through the HPE IMC REST API.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;"><img style="box-sizing: border-box; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto;" src="http://localhost:8888/nbconvert/html/images/executecmd.png" alt="vlan api" /></p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">As you can see from the REST documentation, you need to send a JSON object which is a list of the commands that you would type in from the command prompt of the switch.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">So there are a couple of things we need to prepare the rendered jinja template into a format that can be sent to the API.</p>
<ol style="box-sizing: border-box; margin: 1em 2em 0px; list-style-position: initial; list-style-image: initial; padding-left: 0px;">
<li style="box-sizing: border-box;">
<p style="box-sizing: border-box; margin: 0px;">We need to add the command <span style="box-sizing: border-box; color: blue;">"system-view" </span>to the beginning of the command list.</p>
<blockquote style="box-sizing: border-box; padding: 9px 18px; margin: 1em 2em; font-size: inherit; border-left-width: 5px; border-left-color: #eeeeee;">
<p style="box-sizing: border-box; margin: 0px;">system-view on HPE Comware devices is equivalent to the enable + conf t commands using hte IOS syntax you're probably used to</p>
</blockquote>
</li>
<li style="box-sizing: border-box;">
<p style="box-sizing: border-box; margin: 0px;">We need to split the giant string that rendering the jinja template gave us into a python list with one command per list item. Thankfully, we can use the python <span style="box-sizing: border-box; color: blue;">split</span> method to help us through this. We can use the carriage return symbol to identify the end of each line. python identifies the carriage return by the <span style="box-sizing: border-box; color: blue;">\n</span> characters which is what we're going to use as the input to the split method.</p>
</li>
<li style="box-sizing: border-box;">
<p style="box-sizing: border-box; margin: 0px;">Add the two together.</p>
</li>
</ol></div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [6]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">cmd_list</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="p" style="box-sizing: border-box;">[</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'system-view'</span><span class="p" style="box-sizing: border-box;">]</span>
<span class="n" style="box-sizing: border-box;">cmd_list</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">cmd_list</span> <span class="o" style="box-sizing: border-box; color: #666666;">+</span> <span class="n" style="box-sizing: border-box;">my_template</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">split</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'</span><span class="se" style="box-sizing: border-box; color: #bb6622; font-weight: bold;">\n</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'</span><span class="p" style="box-sizing: border-box;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [7]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">cmd_list</span><span class="p" style="box-sizing: border-box;">[</span><span class="mi" style="box-sizing: border-box; color: #666666;">0</span><span class="p" style="box-sizing: border-box;">:</span><span class="mi" style="box-sizing: border-box; color: #666666;">10</span><span class="p" style="box-sizing: border-box;">]</span>
</pre>
</div>
</div>
</div>
</div>
<div class="output_wrapper" style="box-sizing: border-box; -webkit-box-align: stretch; display: flex; flex-direction: column; align-items: stretch; z-index: 1;">
<div class="output" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch;">
<div class="output_area" style="box-sizing: border-box; padding: 0px; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt output_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: #8b0000;">Out[7]:</div>
<div class="output_text output_subarea output_execute_result" style="box-sizing: border-box; overflow-x: auto; padding: 0.4em; -webkit-box-flex: 1; flex: 1 1 0%; max-width: calc(100% - 14ex); line-height: 1.21429em;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; line-height: inherit; white-space: pre-wrap; vertical-align: baseline; background-color: transparent;">['system-view',
 '#vlan config',
 'vlan 1',
 '    name default',
 '    description default',
 'vlan 2',
 '    name TenantABC',
 '    description TenantABC',
 'vlan 3',
 '    name management']</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Sending-the-commands" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Sending the commands</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [8]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">auth</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">IMCAuth</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #ba2121;">"http://"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #ba2121;">"10.101.0.203"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #ba2121;">"8080"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #ba2121;">"admin"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #ba2121;">"admin"</span><span class="p" style="box-sizing: border-box;">)</span>

</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Getting-the-Device-ID" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Getting the Device ID</h1>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">The input for the run_dev_cmd is the device ID. This is an internal number that IMC uses to idenitfy that specific device. Thankfully, we've also got an RESTful function to get that based on the IP address of the device.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [10]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">devid</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="n" style="box-sizing: border-box;">get_dev_details</span><span class="p" style="box-sizing: border-box;">(</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'10.20.10.10'</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">creds</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">url</span><span class="p" style="box-sizing: border-box;">)[</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'id'</span><span class="p" style="box-sizing: border-box;">]</span>
<span class="n" style="box-sizing: border-box;">devid</span>
</pre>
</div>
</div>
</div>
</div>
<div class="output_wrapper" style="box-sizing: border-box; -webkit-box-align: stretch; display: flex; flex-direction: column; align-items: stretch; z-index: 1;">
<div class="output" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch;">
<div class="output_area" style="box-sizing: border-box; padding: 0px; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt output_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: #8b0000;">Out[10]:</div>
<div class="output_text output_subarea output_execute_result" style="box-sizing: border-box; overflow-x: auto; padding: 0.4em; -webkit-box-flex: 1; flex: 1 1 0%; max-width: calc(100% - 14ex); line-height: 1.21429em;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; line-height: inherit; white-space: pre-wrap; vertical-align: baseline; background-color: transparent;">'221'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [11]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">run_dev_cmd</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">devid</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">cmd_list</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">creds</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">url</span><span class="p" style="box-sizing: border-box;">)[</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'success'</span><span class="p" style="box-sizing: border-box;">]</span>
</pre>
</div>
</div>
</div>
</div>
<div class="output_wrapper" style="box-sizing: border-box; -webkit-box-align: stretch; display: flex; flex-direction: column; align-items: stretch; z-index: 1;">
<div class="output" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch;">
<div class="output_area" style="box-sizing: border-box; padding: 0px; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt output_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: #8b0000;">Out[11]:</div>
<div class="output_text output_subarea output_execute_result" style="box-sizing: border-box; overflow-x: auto; padding: 0.4em; -webkit-box-flex: 1; flex: 1 1 0%; max-width: calc(100% - 14ex); line-height: 1.21429em;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; line-height: inherit; white-space: pre-wrap; vertical-align: baseline; background-color: transparent;">'true'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Double-Checking-the-VLANs" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Double Checking the VLANs</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [12]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="input_area" style="box-sizing: border-box; border: 1px solid #cfcfcf; border-radius: 2px; line-height: 1.21429em; background: #f7f7f7;">
<div class=" highlight hl-ipython3" style="box-sizing: border-box; margin: 0.4em; border: none; padding: 0px; background: transparent;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; line-height: inherit; white-space: pre-wrap; background-color: transparent;"><span class="n" style="box-sizing: border-box;">cmd_list</span> <span class="o" style="box-sizing: border-box; color: #666666;">=</span> <span class="p" style="box-sizing: border-box;">[</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'system-view'</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s" style="box-sizing: border-box; color: #ba2121;">'display vlan'</span><span class="p" style="box-sizing: border-box;">]</span>
<span class="nb" style="box-sizing: border-box; color: #008000;">print</span> <span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">run_dev_cmd</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box;">devid</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">cmd_list</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">creds</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box;">auth</span><span class="o" style="box-sizing: border-box; color: #666666;">.</span><span class="n" style="box-sizing: border-box;">url</span><span class="p" style="box-sizing: border-box;">)[</span><span class="s" style="box-sizing: border-box; color: #ba2121;">'content'</span><span class="p" style="box-sizing: border-box;">])</span>
</pre>
</div>
</div>
</div>
</div>
<div class="output_wrapper" style="box-sizing: border-box; -webkit-box-align: stretch; display: flex; flex-direction: column; align-items: stretch; z-index: 1;">
<div class="output" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch;">
<div class="output_area" style="box-sizing: border-box; padding: 0px; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0px 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em;"> </div>
<div class="output_subarea output_stream output_stdout output_text" style="box-sizing: border-box; overflow-x: auto; padding: 0.4em; -webkit-box-flex: 1; flex: 1 1 0%; max-width: calc(100% - 14ex); line-height: 1.21429em;">
<pre style="box-sizing: border-box; overflow: auto; font-size: inherit; padding: 0px; margin: 0px; word-break: break-all; word-wrap: break-word; border: 0px; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; line-height: inherit; white-space: pre-wrap; vertical-align: baseline; background-color: transparent;"> 1(default), 2-3, 5, 10
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;"> </div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;">
<div class="text_cell_render border-box-sizing rendered_html" style="box-sizing: border-box; outline: 0px; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; overflow-x: auto;">
<h1 id="Getting-better,-right?" style="box-sizing: border-box; font-size: 25.998px; margin: 0.538em 0px 0px; font-family: inherit; line-height: 1; color: inherit;">Getting better, right?</h1>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">So we've come a long way in a short time. We've</p>
<ul style="box-sizing: border-box; margin: 1em 2em 0px; list-style-position: initial; list-style-image: initial; padding-left: 0px;">
<li style="box-sizing: border-box;">started with an introduction to <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="https://kontrolissues.wordpress.com/2016/01/14/intro-to-jinja2/">Jinja2 templating language</a></li>
<li style="box-sizing: border-box;">learned how to <a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="https://kontrolissues.wordpress.com/2016/01/19/more-jinja-working-with-yam-as-an-input/">access templates and input variables from our hard drive</a></li>
<li style="box-sizing: border-box;"><a style="box-sizing: border-box; color: #337ab7; background-color: transparent;" href="https://kontrolissues.wordpress.com/2016/01/29/git-and-jinja-like-peanut-butter-and-pickles/">Moved our access tempaltes and input variables to GitHub so that we can work collabaratively with our team</a></li>
</ul>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">And in this post, we learned how to leverage the first three to deploy configurations directly from code to our devices. This is a big step forward, but there are still a couple of small problems that we need to address</p>
<h2 id="Configuration-Drift" style="box-sizing: border-box; font-family: inherit; line-height: 1; color: inherit; margin: 1.27em 0px 0px; font-size: 21.994px;">Configuration Drift</h2>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">If you look closely, we've actually got an extra VLAN in there. <span style="box-sizing: border-box; font-weight: bold;">VLAN 5</span> has been configured on the device, but it's not in our list of desired_vlans where we have declared exactly which VLANs should be on the target device. This is what is sometimes known as configuration drift. Some people may say</p>
<blockquote style="box-sizing: border-box; padding: 9px 18px; margin: 1em 2em; font-size: inherit; border-left-width: 5px; border-left-color: #eeeeee;">
<p style="box-sizing: border-box; margin: 0px;">Hey, It's just an extra VLAN right? That won't hurt us!</p>
</blockquote>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">Sorry to respectfully disagree, but this attitude is exactly what causes us issues. This is the death of a thousand cuts. It's <span style="box-sizing: border-box; font-weight: bold;">JUST</span> one VLAN, <span style="box-sizing: border-box; font-weight: bold;">JUST</span> one switch running a differnet version of code, <span style="box-sizing: border-box; font-weight: bold;">JUST</span> one router that has some unused sub-interfaces on it.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;"><span style="box-sizing: border-box; font-weight: bold;">IT'S JUST ONE MORE THING THAT WILL BITE YOU WHEN YOU'RE TROUBLESHOOTING AN ISSUE.</span></p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">These <span style="box-sizing: border-box; font-weight: bold;">JUST</span> things are what we sometimes call technical debt. If you can figure out out.</p>
<h2 id="Vendor-Syntax" style="box-sizing: border-box; font-family: inherit; line-height: 1; color: inherit; margin: 1.27em 0px 0px; font-size: 21.994px;">Vendor Syntax</h2>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">The other problem with this example is that we are bound to a specific vendor's syntax. If you attmept to run the <span style="box-sizing: border-box; font-weight: bold;">system-view</span> command on a Juniper/Cisco/Brocade/Extreme/ARISTA device, it's going to error out. Right? This coule easily be addressed by some conditional logic which figures out which kind of a box it is first and then leverages a specific Jinja template for that vendor, but you can see how this becomes a slippery slope rather quickly.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">In the next post, we're going to look at a way to address both of these issues.</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">Stay Tuned!</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">@netmanchris</p>
<p style="box-sizing: border-box; margin: 1em 0px 0px;">P.S. As always, comments and questions are more than welcome.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered" style="box-sizing: border-box; border: thin solid transparent; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; width: 1110px; padding: 5px; margin: 0px; outline: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1;">
<div class="input" style="box-sizing: border-box; page-break-inside: avoid; -webkit-box-orient: horizontal; display: flex; flex-direction: row; align-items: stretch;">
<div class="prompt input_prompt" style="box-sizing: border-box; min-width: 14ex; padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; line-height: 1.21429em; color: navy; border-top-width: 1px; border-top-style: solid; border-top-color: transparent;">In [ ]:</div>
<div class="inner_cell" style="box-sizing: border-box; -webkit-box-orient: vertical; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; flex: 1 1 0%;"> </div>
</div>
</div>